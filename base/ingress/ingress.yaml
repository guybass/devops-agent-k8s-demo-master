# Ingress configuration for external access
# This configuration uses AWS ALB Ingress Controller (recommended for EKS)
# Alternative: NGINX Ingress Controller configuration is also provided
#
# Prerequisites for AWS ALB:
# 1. Install AWS Load Balancer Controller: https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html
# 2. Ensure proper IAM permissions for the controller
# 3. Configure security groups to allow traffic
---
# Main Ingress for the application
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: devops-agent-demo-ingress
  namespace: devops-agent-demo
  labels:
    app.kubernetes.io/name: devops-agent-demo
    app.kubernetes.io/component: ingress
  annotations:
    # AWS ALB Ingress Controller annotations
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'
    # SSL redirect disabled - enable when you have a certificate
    # alb.ingress.kubernetes.io/ssl-redirect: "443"
    # Health check configuration
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "30"
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
    alb.ingress.kubernetes.io/healthy-threshold-count: "2"
    alb.ingress.kubernetes.io/unhealthy-threshold-count: "3"
    # Security - uncomment and add security group IDs if needed
    # alb.ingress.kubernetes.io/security-groups: "sg-xxxxx"
    # SSL/TLS - uncomment and configure for HTTPS
    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:REGION:ACCOUNT:certificate/CERT_ID
    # Tags
    alb.ingress.kubernetes.io/tags: Environment=pre-prod,Project=devops-agent-demo
spec:
  ingressClassName: alb
  rules:
    # Main application (web-ui)
    - host: app.devops-agent-demo.example.com  # Update with your domain
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: web-ui
                port:
                  number: 3000
    # Admin dashboard
    - host: admin.devops-agent-demo.example.com  # Update with your domain
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: admin-dashboard
                port:
                  number: 3001
    # API Gateway
    - host: api.devops-agent-demo.example.com  # Update with your domain
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: api-gateway
                port:
                  number: 8080
---
# Alternative: NGINX Ingress Controller configuration
# Use this if you prefer NGINX Ingress over AWS ALB
# Comment out the ALB Ingress above and uncomment this section
#
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: devops-agent-demo-nginx-ingress
#   namespace: devops-agent-demo
#   labels:
#     app.kubernetes.io/name: devops-agent-demo
#     app.kubernetes.io/component: ingress
#   annotations:
#     kubernetes.io/ingress.class: nginx
#     nginx.ingress.kubernetes.io/ssl-redirect: "true"
#     nginx.ingress.kubernetes.io/proxy-body-size: "50m"
#     nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
#     nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
#     # Rate limiting
#     nginx.ingress.kubernetes.io/limit-rps: "100"
#     nginx.ingress.kubernetes.io/limit-connections: "50"
#     # CORS configuration for API
#     nginx.ingress.kubernetes.io/enable-cors: "true"
#     nginx.ingress.kubernetes.io/cors-allow-origin: "*"
#     nginx.ingress.kubernetes.io/cors-allow-methods: "GET, PUT, POST, DELETE, PATCH, OPTIONS"
#     # TLS configuration - uncomment for HTTPS
#     # cert-manager.io/cluster-issuer: letsencrypt-prod
# spec:
#   ingressClassName: nginx
#   tls:
#     - hosts:
#         - app.devops-agent-demo.example.com
#         - admin.devops-agent-demo.example.com
#         - api.devops-agent-demo.example.com
#       secretName: devops-agent-demo-tls
#   rules:
#     - host: app.devops-agent-demo.example.com
#       http:
#         paths:
#           - path: /
#             pathType: Prefix
#             backend:
#               service:
#                 name: web-ui
#                 port:
#                   number: 3000
#     - host: admin.devops-agent-demo.example.com
#       http:
#         paths:
#           - path: /
#             pathType: Prefix
#             backend:
#               service:
#                 name: admin-dashboard
#                 port:
#                   number: 3001
#     - host: api.devops-agent-demo.example.com
#       http:
#         paths:
#           - path: /
#             pathType: Prefix
#             backend:
#               service:
#                 name: api-gateway
#                 port:
#                   number: 8080
